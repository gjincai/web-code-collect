(function(t){var e=0,i=1,o=1,a="",n=!1,s=!1,r="0",c=5,d=function(){this.$btn_join=t(".btn-join"),this.$login_start=t(".login-start"),this.$login_after=t(".login-after"),this.$login_role_bind=t(".login-role-bind"),this.$login_role_change=t(".login-role-change"),this.$login_prize=t(".login-prize"),this.$login_rule=t(".login-rule"),this.$task=t(".lottery-task"),this.$lottery_start=t("#J_lottery_start"),this.$select_card=t(".J_select_card"),this.$share_qrcode=t(".share-qrcode"),this.$btn_merge=t(".btn-merge"),this.$btn_send=t(".btn-send"),this.$dialog_login=t("#J_dialog_login"),this.$dialog_lottery=t("#J_dialog_lottery"),this.$dialog_send=t("#J_dialog_send"),this.$dialog_select=t("#J_dialog_select"),this.$dialog_share=t("#J_dialog_share"),this.$dialog_rare=t("#J_dialog_rare"),this.$dialog_my=t("#J_dialog_my"),this.$dialog_address=t("#J_dialog_address"),this.$dialog_bind=t("#J_dialog_bind"),this.$dialog_packet=t("#J_dialog_packet"),this.$dialog_loading=t("#J_dialog_loading"),this.$device_select=t(".device-select"),this.$service_select=t(".service-select"),this.$role_select=t(".role-select"),this.copyAcc="",this.cardId="",this.cardCode="",this.mixAcc="",this.login_type="1",this.sms_timer=null,this.isFirst=!0,this.is_ally=!1,this.pla_id="",this.srv_id="",this.role_id="",this.role_name="",this.deviceSelect=null,this.serviceSelect=null,this.roleSelect=null,this.config={project_id:"11",sdkapi_secret:"SQz7RrTGbb0j7NCK",commonapi_secret:"JZ0PJRVzpUctYExk",activity_secret:"JZ0Psf67jc10U05cykVzpUctYExk",payapi_key:"webpayqrcode",payapi_web_url:"http://test-pay.shiyue.com",sdkapi_web_url:"http://test.shiyue.com",commonapi_web_url:"http://test-common-api.shiyue.com",activityapi_url:"http://test-activity.shiyue.com",base_url:"http://test-cms-sszg.shiyue.com/m/anniversary.html"}};t.extend(d.prototype,{init:function(){this.initialize(),this.bindEvent(),this.slideInit(),this.swiperInit(),this.selectArea(),this.copy()},initialize:function(){var t=this,e=t.getQueryStr("token"),i=t.getQueryStr("code"),o=t.getQueryStr("copyAcc"),a=t.getQueryStr("type"),n=t.getQueryStr("cardId"),s=t.getQueryStr("cardCode"),r=storage.getItem("sy_token"),c=storage.getItem("sy_acc"),d=storage.getItem("sy_mixAcc"),l=storage.getItem("sy_is_ally"),g=null!=c||null!=d;if(null!=o){t.copyAcc=o,t.cardId=n,t.cardCode=s;var p=t.lotteryCard(parseInt(n)),_=p.type,u=p.img;t.$dialog_packet.find(".lottery-res span").html(_),t.$dialog_packet.find(".lottery-card").html(u),g?t.$dialog_packet.find(".btn-accept").addClass("is-login"):t.$dialog_packet.find(".btn-accept").removeClass("is-login"),t.$dialog_packet.show(),"2"==a&&(t.login_type="3")}var m={token:"",copyAcc:t.copyAcc,mixAcc:"",type:1,step:1};null!=e?(t.buryLog(m),t.loginToken(e)):null!=i?(t.buryLog(m),t.loginCode(i)):g?(l?(t.mixAcc=d,m.type=2,m.mixAcc=d,t.setAccInfo()):(m.token=r,m.type=1,t.setAccInfo()),t.buryLog(m)):(t.$login_start.show(),t.$login_after.hide(),t.$login_role_bind.hide(),t.$login_role_change.hide(),t.$login_prize.hide(),t.buryLog(m)),t.selectInit()},bindEvent:function(){this.$btn_join.on("click",t.proxy(this.join,this)),this.$login_start.on("click",t.proxy(this.loginPop,this)),this.$login_after.on("click",t.proxy(this.logout,this)),this.$login_prize.on("click",t.proxy(this.myPop,this)),this.$login_role_bind.on("click",t.proxy(this.bindPop,this)),this.$login_role_change.on("click",t.proxy(this.bindPop,this)),this.$dialog_bind.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_bind)),this.$dialog_bind.on("click",".btn-comfirm",t.proxy(this.updateRole,this)),this.$dialog_login.on("click",".select-menu li",t.proxy(this.loginTab,this)),this.$dialog_login.on("click",".pic-captcha",t.proxy(this.refreshCaptcha,this)),this.$dialog_login.on("click",".login-submit",t.proxy(this.loginSubmit,this)),this.$dialog_login.on("click",".get-sms",t.proxy(this.getSms,this,this.$dialog_login,"phone_login")),this.$dialog_login.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_login)),this.$lottery_start.on("click","li",t.proxy(this.lottery,this)),this.$dialog_lottery.on("click",".lottery-mid a",t.proxy(this.myPop,this)),this.$dialog_lottery.on("click",".btn-comfirm",t.proxy(this.myPop,this)),this.$dialog_lottery.on("click",".btn-receive",t.proxy(this.addressPop,this)),this.$dialog_lottery.on("click",".btn-gather",t.proxy(this.gatherPop,this)),this.$dialog_lottery.on("click",".btn-rare",t.proxy(this.rarePop,this)),this.$dialog_lottery.on("click",".btn-back1",t.proxy(this.closePop,this,this.$dialog_lottery)),this.$dialog_lottery.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_lottery)),this.$select_card.on("click","li",t.proxy(this.selectCard,this)),this.$dialog_send.on("click",".btn-back2",t.proxy(this.closePop,this,this.$dialog_send)),this.$dialog_send.on("click",".btn-share",t.proxy(this.sharePop,this)),this.$dialog_share.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_share)),this.$dialog_rare.on("click",".btn-open",t.proxy(this.divide,this)),this.$dialog_rare.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_rare)),this.$btn_merge.on("click",t.proxy(this.merge,this)),this.$btn_send.on("click",t.proxy(this.send,this)),this.$dialog_select.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_select)),this.$dialog_my.on("click",".my-add",t.proxy(this.addPop,this)),this.$dialog_my.on("click",".receive",t.proxy(this.receive,this)),this.$dialog_my.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_my)),this.$dialog_address.on("click",".btn-save",t.proxy(this.saveAddress,this)),this.$dialog_address.on("click",".dialog-close",t.proxy(this.closePop,this,this.$dialog_address)),this.$dialog_packet.on("click",".btn-accept",t.proxy(this.getShareCard,this)),this.$task.on("click",t.proxy(this.task,this)),this.$login_rule.on("click",t.proxy(this.rule,this))},getQueryStr:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1),o=Base64.decode(i),a=o.match(e);return null!=a?decodeURIComponent(a[2]):null},isPhone:function(t){var e=/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])(\d{8}$)/;return!!e.test(t)},join:function(e){if(!this.isLogin())return!1;var i=t(".lottery-tips").offset().top-t(".header").height();t("html,body").animate({scrollTop:i},700)},loginPop:function(t){this.$dialog_login.show(),this.getCaptcha("login"),"3"==this.login_type&&(this.$dialog_login.find(".select-menu li").removeClass("cur"),this.$dialog_login.find(".select-menu li").eq(2).addClass("cur"),this.$dialog_login.find(".dialog-login").removeClass("t1 t2 t3"),this.$dialog_login.find(".dialog-login").addClass("t3"),this.$dialog_login.find(".login-box").hide(),this.$dialog_login.find(".login-box").eq(2).show())},loginTab:function(e){e=e||window.event;var i=e.currentTarget,o=t(i).index(),a=t(i).attr("data-login_type");this.login_type=a,t(i).addClass("cur").siblings().removeClass("cur"),this.$dialog_login.find(".dialog-login").removeClass("t1 t2 t3"),this.$dialog_login.find(".dialog-login").addClass("t"+a),this.$dialog_login.find(".login-box").hide(),this.$dialog_login.find(".login-box").eq(o).show()},getCaptcha:function(e){var i=this,o={};o.type=e||"login",o.ts=Math.round(new Date/1e3),o.sign=sign(o,i.config.sdkapi_secret),t.ajax({url:i.config.sdkapi_web_url+"/web/captcha",type:"post",data:o,success:function(t){0==t.code?(i.$dialog_login.find(".pic-captcha").attr("src",t.data.captcha),i.$dialog_login.find('input[name="captcha"]').val(),i.$dialog_login.find(".captcha").show()):i.$dialog_login.toast({content:"获取图片验证码失败，请稍候再试~",duration:2e3})},complete:function(t,e){200!=t.status&&i.$dialog_login.toast({content:"获取图片验证码失败，请稍候再试~",duration:2e3})}})},refreshCaptcha:function(t){this.getCaptcha("login")},countDown:function(t){var e=this,i=60;e.sms_timer=setInterval(function(){0==i?(t.text("获取验证码").removeAttr("disabled").removeClass("gray"),clearInterval(e.sms_timer)):(t.text("已发送("+i+"s)"),t.attr("disabled",!0).addClass("gray")),i--},1e3)},getSms:function(e,i){var o=this,a={},n=e.find('input[name="phone"]').val();if(""==n||!o.isPhone(n))return e.toast({content:"请输入11位手机号码~",duration:2e3}),!1;a.phone_number=n,a.sms_type=i,a.ts=Math.round(new Date/1e3),a.sign=sign(a,o.config.sdkapi_secret),o.countDown(e.find(".get-sms")),t.ajax({url:o.config.sdkapi_web_url+"/web/sms/send",type:"post",data:a,success:function(t){0==t.code?e.toast({content:"手机验证码发送成功~",duration:2e3}):(e.find(".get-sms").text("获取验证码").removeAttr("disabled").removeClass("gray"),clearInterval(o.sms_timer),e.toast({content:t.message,duration:2e3}))},complete:function(t,i){200!=t.status&&e.toast({content:"服务器出小差，请稍候再试~",duration:2e3})}})},setAccInfo:function(){var t=this;t.copyAcc?t.getShareCard():t.getInfo("login")},renderCard:function(t){var e=this;t.card_1.num>0&&(e.$select_card.find(".card-item1").addClass("show"),e.$select_card.find(".card-item1").attr("data-num",t.card_1.num),e.$select_card.find(".card-item1 .num").html(t.card_1.num)),t.card_2.num>0&&(e.$select_card.find(".card-item2").addClass("show"),e.$select_card.find(".card-item2").attr("data-num",t.card_2.num),e.$select_card.find(".card-item2 .num").html(t.card_2.num)),t.card_3.num>0&&(e.$select_card.find(".card-item3").addClass("show"),e.$select_card.find(".card-item3").attr("data-num",t.card_3.num),e.$select_card.find(".card-item3 .num").html(t.card_3.num)),t.card_4.num>0&&(e.$select_card.find(".card-item4").addClass("show"),e.$select_card.find(".card-item4").attr("data-num",t.card_4.num),e.$select_card.find(".card-item4 .num").html(t.card_4.num)),t.card_5.num>0&&(e.$select_card.find(".card-item5").addClass("show"),e.$select_card.find(".card-item5").attr("data-num",t.card_5.num),e.$select_card.find(".card-item5 .num").html(t.card_5.num))},setInfo:function(i,o){var a=this;if(a.$login_start.hide(),a.$login_after.show(),a.$login_prize.show(),"2"==i.acc_type){var n=i.role_info.server_name+"-"+i.role_info.role_name;a.$login_after.find("span").html(n)}else{var d=storage.getItem("sy_acc"),l=""==d.phone_number?d.name:d.phone_number;if(a.$login_after.find("span").html(l),"login"==o)if(null==i.role_info)a.$login_role_change.hide(),a.$login_role_bind.show();else{n=i.role_info.server_name+"-"+i.role_info.role_name;a.$login_role_change.find("span").html(n),a.$login_role_bind.hide(),a.$login_role_change.show()}}if(e=parseInt(i.num),s=parseInt(i.is_commit_address),c=parseInt(i.need_card_num),r=i.is_success,t(".lottery-num").find("span").html(i.num),"1"==r?a.$select_card.find(".card-item0").addClass("show").removeClass("hide"):a.$select_card.find(".card-item0").addClass("hide").removeClass("show"),this.renderCard(i),storage.setItem("sy_role_info",i.role_info),"1"==i.back_status&&null!=i.role_info&&""!=a.copyAcc&&a.getBackRole(),a.isFirst){var g=parseInt(i.get_back_card);if(4==g||5==g||6==g||7==g||8==g){var p=a.lotteryCard(g);t("body").toast({position:"fixed",fontSize:"13px",textAlign:"center",content:"你邀请的玩家已回归，"+p.type+"卡已发放~",duration:2e3})}else i.is_first?t("body").toast({position:"fixed",fontSize:"13px",textAlign:"center",content:"您获得了一次抽卡机会，快来试试你的欧气吧",duration:2e3}):t("body").toast({position:"fixed",fontSize:"13px",textAlign:"center",content:"已获得本日免费抽奖机会, 快来参与任务获得更多机会吧~",duration:2e3})}},getInfo:function(e){var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_mixAcc"),n=storage.getItem("sy_is_ally"),s={};s.token=o,s.type=1,n&&(s.token=0,s.type=2,s.mixAcc=a),s.ts=Math.round(new Date/1e3),s.sign=sign(s,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/main",data:s,type:"post",success:function(a){0==a.code?i.setInfo(a.data,e):1003==a.code?i.refreshToken(o,t.proxy(i.getInfo,i,e)):(storage.removeItem("sy_acc"),storage.removeItem("sy_mixAcc"),storage.removeItem("sy_is_ally"),storage.removeItem("sy_role_info"),storage.removeItem("sy_token"))},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},refreshToken:function(e,i){var o=this,a={};a.token=e,a.ts=Math.round(new Date/1e3),a.sign=sign(a,o.config.sdkapi_secret),t.ajax({url:o.config.sdkapi_web_url+"/web/token/refresh",type:"post",data:a,success:function(t){0==t.code?(storage.setItem("sy_token",t.data.token),i&&i()):console.log(t.message)},complete:function(t,e){200!=t.status&&console.log("请求出错")}})},loginToken:function(e){var i=this,o={};o.token=e,o.ts=Math.round(new Date/1e3),o.sign=sign(o,i.config.sdkapi_secret),t.ajax({url:i.config.sdkapi_web_url+"/web/token/loginToken",data:o,type:"post",success:function(e){if(0==e.code){storage.removeItem("sy_mixAcc"),storage.removeItem("sy_is_ally"),storage.setItem("sy_acc",e.data,36e6),storage.setItem("sy_token",e.data.token);var o={token:e.data.token,copyAcc:i.copyAcc,mixAcc:i.mixAcc,type:1,step:2};i.buryLog(o,function(){i.setAccInfo(),i.$dialog_login.hide()})}else t("body").toast({position:"fixed",textAlign:"center",content:e.message,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},loginCode:function(e){var i=this,o={};o.code=e,o.ts=Math.round(new Date/1e3),o.sign=sign(o,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/codeLogin",data:o,type:"post",success:function(e){if(0==e.code){i.mixAcc=e.data.account_id,storage.removeItem("sy_acc"),storage.removeItem("sy_token"),storage.setItem("sy_mixAcc",i.mixAcc,36e6),storage.setItem("sy_is_ally",!0,36e6);var o={token:"",copyAcc:i.copyAcc,mixAcc:i.mixAcc,type:2,step:2};i.buryLog(o,function(){i.setAccInfo(),i.$dialog_login.hide()})}else t("body").toast({position:"fixed",content:e.message,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},loginWeb:function(e,i){var o=this;t.ajax({url:o.config.sdkapi_web_url+i,data:e,type:"post",success:function(t){if(0==t.code){storage.removeItem("sy_mixAcc"),storage.removeItem("sy_is_ally"),storage.setItem("sy_acc",t.data,36e6),storage.setItem("sy_token",t.data.token);var e={token:t.data.token,copyAcc:o.copyAcc,mixAcc:o.mixAcc,type:1,step:2};o.buryLog(e,function(){o.setAccInfo(),o.$dialog_login.hide()})}else 1102==t.code?o.$dialog_login.toast({textAlign:"center",content:"密码输入错误，非官方账号玩家请使用游戏验证登录",duration:2e3}):o.$dialog_login.toast({content:t.message,textAlign:"center",duration:2e3})},complete:function(t,e){200!=t.status&&o.$dialog_login.toast({textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},loginSubmit:function(t){var e=this,i="/web/login",o={},a=e.$dialog_login.find(".select-menu li.cur").attr("data-login_type");if("1"==a){if(i="/web/login",o.phone_number=e.$dialog_login.find('input[name="username"]').val(),o.password=e.$dialog_login.find('input[name="pwd"]').val(),o.code=e.$dialog_login.find('input[name="captcha"]').val(),""==o.phone_number)return e.$dialog_login.toast({textAlign:"center",content:"请输入手机号/账号~",duration:3e3}),!1;if(""==o.password)return e.$dialog_login.toast({textAlign:"center",content:"请输入密码~",duration:3e3}),!1;if(!/^[0-9a-zA-Z]{5}$/.test(o.code))return e.$dialog_login.toast({textAlign:"center",content:"请输入正确的验证码~",duration:3e3}),!1;o.ts=Math.round(new Date/1e3),o.sign=sign(o,e.config.sdkapi_secret),e.loginWeb(o,i)}else if("2"==a){if(i="/web/phoneLogin",o.phone_number=e.$dialog_login.find('input[name="phone"]').val(),o.code=e.$dialog_login.find('input[name="code"]').val(),""==o.phone_number||!e.isPhone(o.phone_number))return e.$dialog_login.toast({textAlign:"center",content:"请输入11位手机号码~",duration:2e3}),!1;if(""==o.code)return e.$dialog_login.toast({textAlign:"center",content:"请输入短信验证码~",duration:2e3}),!1;if(!/^[0-9]{4}$/.test(o.code))return e.$dialog_login.toast({textAlign:"center",content:"请输入正确短信验证码~",duration:2e3}),!1;o.ts=Math.round(new Date/1e3),o.sign=sign(o,e.config.sdkapi_secret),e.loginWeb(o,i)}else{var n=e.$dialog_login.find('input[name="gcode"]').val();if(""==n)return e.$dialog_login.toast({textAlign:"center",content:"请输入游戏验证码~",duration:2e3}),!1;e.loginCode(n)}},logout:function(t){storage.removeItem("sy_acc"),storage.removeItem("sy_mixAcc"),storage.removeItem("sy_is_ally"),storage.removeItem("sy_role_info"),storage.removeItem("sy_token"),window.location.href=this.config.base_url},isLogin:function(){var t=this,e=storage.getItem("sy_acc"),i=storage.getItem("sy_mixAcc"),o=null!=e||null!=i;return!!o||(t.loginPop(),!1)},actEnd:function(t){var e=Date.now(),i=new Date(t).getTime();return e-i>=0},lotteryCard:function(t){var e={img:"",title:"",type:""};switch(t){case 4:e={img:'<img src="assets/jk/images/card/card1.png" />',title:"水の祝福",type:"水元素",id:4};break;case 5:e={img:'<img src="assets/jk/images/card/card2.png" />',title:"火の簇拥",type:"火元素",id:5};break;case 6:e={img:'<img src="assets/jk/images/card/card3.png" />',title:"风の加持",type:"风元素",id:6};break;case 7:e={img:'<img src="assets/jk/images/card/card4.png" />',title:"暗の环绕",type:"暗元素",id:7};break;case 8:e={img:'<img src="assets/jk/images/card/card5.png" />',title:"光の庇佑",type:"光元素",id:8}}return e},lottery:function(i){i=i||window.event;var o=i.currentTarget,a=t(o).hasClass("flop"),n=this;if(this.actEnd("2020/07/02 23:59:00"))return t("body").toast({position:"fixed",content:"抽卡活动已结束，请尽快领取活动奖励哦~",duration:2e3}),!1;if(!n.isLogin())return!1;var s=storage.getItem("sy_role_info");if(!s)return n.bindPop(),!1;if(e<=0){t("body").toast({position:"fixed",textAlign:"center",content:"抽奖次数不足~",duration:2e3});var r=t(".page3 .title").offset().top-30;return t("html,body").animate({scrollTop:r},700),!1}a?t(o).removeClass("flop"):t(o).addClass("flop"),setTimeout(function(){n.lotteryStart()},2e3)},lotteryStart:function(){var s=this,r=storage.getItem("sy_token"),d=storage.getItem("sy_mixAcc"),l=storage.getItem("sy_is_ally");if(n)return!1;n=!n,api_params={},api_params.token=r,api_params.type=1,l&&(api_params.token=0,api_params.type=2,api_params.mixAcc=d),api_params.ts=Math.round(new Date/1e3),api_params.sign=sign(api_params,s.config.activity_secret),t.ajax({url:s.config.activityapi_url+"/anniversary/luckDraw",data:api_params,type:"post",success:function(n){0==n.code?(e=parseInt(n.data.draw_num),i=parseInt(n.data.gift_id),o=parseInt(n.data.gift_type),a=n.data.gift_name,c=parseInt(n.data.need_card_num),s.lotteryEnd(i,o,a,c)):1003==n.code?s.refreshToken(r,t.proxy(s.lottery,s)):t("body").toast({position:"fixed",textAlign:"center",content:n.message,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},lotteryEnd:function(t,e,i,a){var s=this,c=storage.getItem("sy_token"),d=storage.getItem("sy_is_ally");if(o=e,4==t||5==t||6==t||7==t||8==t){var l=s.lotteryCard(t),g=l.title,p=l.type,_=l.img,u="";u="1"==r?"你已合成5张元素卡,坐等开奖~":a>0?"还差"+a+"张卡片集齐五元素卡，瓜分5亿钻石大礼吧〜":"你已集齐5张元素卡,赶紧合成吧~",s.$dialog_lottery.find(".lottery-success3 .lottery-res span").html(g),s.$dialog_lottery.find(".lottery-success3 .lottery-name span").html(p),s.$dialog_lottery.find(".lottery-card").html(_),s.$dialog_lottery.find(".lottery-collect").html(u),s.$dialog_lottery.find(".lottery-success").hide(),s.$dialog_lottery.find(".lottery-success3").show()}else s.$dialog_lottery.find(".lottery-success2 .lottery-res span").html(i),s.$dialog_lottery.find(".lottery-img").html('<img src="assets/jk/images/prize/'+t+'.png" />'),s.$dialog_lottery.find(".lottery-success").hide(),s.$dialog_lottery.find(".lottery-success2").show();s.$dialog_lottery.show(),n=!n,s.isFirst=!1,s.getInfo();var m={token:c,copyAcc:s.copyAcc,mixAcc:s.mixAcc,type:1,step:3};d&&(m.token="",m.type=2),s.buryLog(m)},gatherPop:function(){var e=this;t("body").toast({position:"fixed",textAlign:"center",content:"领取成功，钻石请前往【我的奖品】领取~",duration:2e3}),setTimeout(function(){e.$dialog_lottery.hide()},2e3)},rarePop:function(){var e=this;t("body").toast({position:"fixed",textAlign:"center",content:"领取成功，头像框请前往【我的奖品】领取~",duration:2e3}),setTimeout(function(){e.$dialog_lottery.hide()},2e3)},cardIdx:function(t){var e={img:"",title:"",type:""};switch(t){case 1:e={img:'<img src="assets/jk/images/card/card1.png" />',title:"水の祝福",type:"水元素",id:4};break;case 2:e={img:'<img src="assets/jk/images/card/card2.png" />',title:"火の簇拥",type:"火元素",id:5};break;case 3:e={img:'<img src="assets/jk/images/card/card3.png" />',title:"风の加持",type:"风元素",id:6};break;case 4:e={img:'<img src="assets/jk/images/card/card4.png" />',title:"暗の环绕",type:"暗元素",id:7};break;case 5:e={img:'<img src="assets/jk/images/card/card5.png" />',title:"光の庇佑",type:"光元素",id:8}}return e},selectCard:function(e){e=e||window.event;var i=e.currentTarget,o=parseInt(t(i).attr("data-card")),a=parseInt(t(i).attr("data-num"));if(!this.isLogin())return!1;if(0==o)return this.$dialog_select.hide(),this.$dialog_rare.show(),!1;a<2?this.$dialog_send.find(".btn-share").hide():this.$dialog_send.find(".btn-share").show();var n=this.cardIdx(o),s="";s="1"==r?"你已合成5张元素卡,坐等开奖~":c>0?"还差"+c+"张卡片集齐五元素卡，瓜分5亿钻石大礼吧〜":"你已集齐5张元素卡,赶紧合成吧~",this.$dialog_send.find(".lottery-res span").html(n.title),this.$dialog_send.find(".lottery-name span").html(n.type),this.$dialog_send.find(".lottery-card").html(n.img),this.$dialog_send.find(".lottery-collect").html(s),this.$dialog_send.find(".btn-share").attr("data-card",o),this.$dialog_select.hide(),this.$dialog_send.show()},merge:function(){if(!this.isLogin())return!1;if(this.actEnd("2020/07/02 10:00:00"))return t("body").toast({position:"fixed",textAlign:"center",content:"合成失败~钻石瓜分已开始o(╥﹏╥)o",duration:2e3}),!1;if("1"==r)return this.$dialog_rare.show(),!1;var e=this,i=storage.getItem("sy_token"),o=storage.getItem("sy_mixAcc"),a=storage.getItem("sy_is_ally");api_params={},api_params.token=i,api_params.type=1,a&&(api_params.token=0,api_params.type=2,api_params.mixAcc=o),api_params.ts=Math.round(new Date/1e3),api_params.sign=sign(api_params,e.config.activity_secret),t.ajax({url:e.config.activityapi_url+"/anniversary/merge",data:api_params,type:"post",success:function(o){0==o.code||5001==o.code?(e.$dialog_lottery.show(),e.$dialog_lottery.find(".lottery-success").hide(),e.$dialog_lottery.find(".lottery-success4").show(),e.isFirst=!1,e.getInfo()):1003==o.code?e.refreshToken(i,t.proxy(e.merge,e)):5002==o.code?t("body").toast({position:"fixed",textAlign:"center",content:"还差"+c+"张集齐哦，继续做任务抽奖吧~",duration:2e3}):t("body").toast({position:"fixed",textAlign:"center",content:o.message,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},send:function(){if(!this.isLogin())return!1;this.$dialog_select.show()},divide:function(){return!!this.isLogin()&&(this.actEnd("2020/07/02 10:00:00")?void 0:(t("body").toast({position:"fixed",textAlign:"center",content:"还未开奖，敬请期待哦~",duration:2e3}),!1))},qrcodeInit:function(t,e,i,o){var a=Base64.encode("copyAcc="+t+"&type="+e+"&cardId="+i+"&cardCode="+o),n=this.config.base_url+"?"+a,s=this.$share_qrcode.qrcode({width:228,height:228,text:n});return console.log("copyAcc="+t+"&type="+e+"&cardId="+i+"&cardCode="+o),console.log(n),s},getPixelRatio:function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},drawAndShareImage:function(t,e){var i=this,o=document.createElement("canvas"),a=o.getContext("2d"),n=i.getPixelRatio(a);o.width=750*n,o.height=1224*n,a.fillStyle="#fff",a.rect(0,0,o.width,o.height);var s=new Image;s.src="./assets/jk/images/share/"+e+".jpg",s.crossOrigin="Anonymous",s.onload=function(){a.drawImage(s,0,0,750*n,1224*n);var e=new Image;e.src=t,e.crossOrigin="Anonymous",e.onload=function(){a.fillStyle="#fff",a.rect(0,0,o.width,o.height),a.drawImage(e,286*n,936*n,180*n,180*n);var t=o.toDataURL("image/jpeg");i.$dialog_share.find(".share-card .download").attr("href",t),i.$dialog_share.find(".share-card img").attr("src",t),i.$dialog_loading.hide(),i.$dialog_share.show()}}},getBuildCode:function(e){var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_acc"),n=storage.getItem("sy_mixAcc"),s=storage.getItem("sy_is_ally"),r=i.cardIdx(e),c=r.id,d="",l=1;i.$dialog_send.hide(),i.$dialog_loading.show(),api_params={},api_params.token=o,api_params.type=1,s?(api_params.token=0,api_params.type=2,api_params.mixAcc=n,d=n,l=2):(d=a.account_id,l=1),api_params.card_id=c,api_params.ts=Math.round(new Date/1e3),api_params.sign=sign(api_params,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/buildCode",data:api_params,type:"post",success:function(a){if(0==a.code){var r=a.data.code,g=i.qrcodeInit(d,l,c,r),p=g.find("canvas").get(0).toDataURL();i.drawAndShareImage(p,e);var _={token:o,copyAcc:i.copyAcc,mixAcc:"",type:1,step:4};s&&(_.token="",_.type=2,_.mixAcc=n),i.buryLog(_,function(){i.isFirst=!1,i.getInfo()})}else 5003==a.code?(i.$dialog_loading.hide(),t("body").toast({position:"fixed",textAlign:"center",content:"多出的卡片才可以分享给好友哦~",duration:2e3})):(i.$dialog_loading.hide(),t("body").toast({position:"fixed",textAlign:"center",content:a.message,duration:2e3}))},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},sharePop:function(e){e=e||window.event;var i=e.currentTarget,o=parseInt(t(i).attr("data-card"));if(!this.isLogin())return this.$dialog_send.hide(),!1;this.getBuildCode(o)},bindPop:function(){var t=this;t.getPlatforms(t.config.project_id),t.$dialog_bind.show()},selectInit:function(){var t=this;t.deviceSelect=new MobileSelect({trigger:".device-select",title:"请选择平台",wheels:[{data:[{id:"",name:"暂无平台"}]}],keyMap:{id:"id",value:"name"},callback:function(e,i){if(t.srv_id="",t.$service_select.html("<span>请选择区服</span>"),t.role_id="",t.role_name="",t.$role_select.html("<span>请选择角色</span>"),t.pla_id=i[0].id||"",""==t.pla_id)return!1;t.getServers(t.pla_id)}}),t.serviceSelect=new MobileSelect({trigger:".service-select",title:"请选择区服",wheels:[{data:[{server_id:"",server_name:"暂无区服"}]}],keyMap:{id:"server_id",value:"server_name"},callback:function(e,i){if(t.role_id="",t.role_name="",t.$role_select.html("<span>请选择角色</span>"),t.srv_id=i[0].server_id||"",""==t.srv_id)return!1;t.getRole(t.srv_id)}}),t.roleSelect=new MobileSelect({trigger:".role-select",title:"请选择角色",wheels:[{data:[{role_id:"",role_name:"暂无角色"}]}],keyMap:{id:"role_id",value:"role_name"},callback:function(e,i){t.role_id=i[0].role_id,t.role_name=i[0].role_name}})},getPlatforms:function(e){var i=this,o={};o.project_id=e,o.ts=Math.round(new Date/1e3),o.sign=sign(o,i.config.payapi_key),t.ajax({url:i.config.payapi_web_url+"/webPay/platforms",type:"post",data:o,success:function(e){0==e.code&&0!=e.data.length?i.deviceSelect.updateWheel(0,e.data):t("body").toast({position:"fixed",content:"获取平台失败，请稍候再试~",duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},getServers:function(e){var i=this,o=storage.getItem("sy_acc");if(api_params={},null==o)return i.loginPop(),!1;api_params.name=o.name,api_params.project_id=i.config.project_id,api_params.platform=e,api_params.ts=Math.round(new Date/1e3),api_params.sign=sign(api_params,i.config.commonapi_secret),t.ajax({url:i.config.commonapi_web_url+"/project/getOwnServers",type:"post",data:api_params,success:function(e){0==e.code?0!=e.data.length?i.serviceSelect.updateWheel(0,e.data):t("body").toast({position:"fixed",content:"暂无玩过的区服，请重新选择",duration:2e3}):t("body").toast({position:"fixed",content:"获取区服失败，请稍候再试~",duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},getRole:function(e){var i=this,o=storage.getItem("sy_token");acc=storage.getItem("sy_acc"),api_params={},api_params.project_id=i.config.project_id,api_params.server_id=e,api_params.name=acc.name,api_params.token=o,api_params.ts=Math.round(new Date/1e3),api_params.sign=sign(api_params,i.config.commonapi_secret),t.ajax({url:i.config.commonapi_web_url+"/project/getRole",type:"post",data:api_params,success:function(a){0==a.code&&0!=a.data.length?i.roleSelect.updateWheel(0,a.data):1003==a.code?i.refreshToken(o,t.proxy(i.getRole,i,e)):t("body").toast({position:"fixed",content:"获取角色失败，请重新选择",duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},updateRole:function(){var e=this,i=storage.getItem("sy_token"),o=storage.getItem("sy_mixAcc"),a=storage.getItem("sy_is_ally"),n={};if(n.token=i,n.type=1,a&&(n.token=0,n.type=2,n.mixAcc=o),""==e.pla_id)return e.$dialog_bind.toast({position:"fixed",textAlign:"center",content:"请选择您的平台~",duration:2e3}),!1;if(""==e.srv_id)return e.$dialog_bind.toast({position:"fixed",textAlign:"center",content:"请选择您的区服~",duration:2e3}),!1;if(""==e.role_id)return e.$dialog_bind.toast({position:"fixed",textAlign:"center",content:"请选择您的角色~",duration:2e3}),!1;var s=e.serviceSelect.getValue(),r=s[0].server_id.split("_");n.platform=r[0],n.zone_id=r[1],n.server_name=s[0].server_name;var c=e.roleSelect.getValue();n.role_id=c[0].role_id,n.role_name=c[0].role_name,n.ts=Math.round(new Date/1e3),n.sign=sign(n,e.config.activity_secret),t.ajax({url:e.config.activityapi_url+"/anniversary/editRole",data:n,type:"post",success:function(o){0==o.code?(t("body").toast({position:"fixed",textAlign:"center",content:"角色绑定成功~",duration:2e3}),e.isFirst=!1,e.getInfo("login"),e.$dialog_bind.hide()):1003==o.code?e.refreshToken(i,t.proxy(e.updateRole,e)):t("body").toast({position:"fixed",textAlign:"center",content:o.message,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},bindRole:function(e){var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_mixAcc"),n=storage.getItem("sy_is_ally"),s={};s.token=o,s.type=1,n&&(s.token=0,s.type=2,s.mixAcc=a),s.zone_id=e.zone_id,s.platform=e.platform,s.server_name=e.server_name,s.role_id=e.role_id,s.role_name=e.role_name,s.ts=Math.round(new Date/1e3),s.sign=sign(s,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/editRole",data:s,type:"post",success:function(e){0==e.code?(i.isFirst=!1,i.getInfo(),i.$dialog_bind.hide()):1003==e.code?i.refreshToken(o,t.proxy(i.bindRole,i)):t("body").toast({position:"fixed",textAlign:"center",content:e.message,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},getShareCard:function(){if(!this.isLogin())return this.$dialog_packet.hide(),!1;if(this.$dialog_packet.hide(),!this.cardCode)return!1;var e=this,i=storage.getItem("sy_token"),o=storage.getItem("sy_mixAcc"),a=storage.getItem("sy_is_ally"),n={};n.token=i,n.type=1,a&&(n.token=0,n.type=2,n.mixAcc=o),n.code=e.cardCode,n.ts=Math.round(new Date/1e3),n.sign=sign(n,e.config.activity_secret),t.ajax({url:e.config.activityapi_url+"/anniversary/getShareCard",data:n,type:"post",success:function(n){0==n.code?t("body").toast({position:"fixed",textAlign:"center",content:"领取成功~",duration:2e3}):5004==n.code?t("body").toast({position:"fixed",textAlign:"center",content:"o(╥﹏╥)o卡片已被领取~",duration:2e3}):5006==n.code?t("body").toast({position:"fixed",textAlign:"center",content:"领取失败，你已拥有该卡片~",duration:2e3}):t("body").toast({position:"fixed",textAlign:"center",content:n.message,duration:2e3});var s={token:i,copyAcc:e.copyAcc,mixAcc:"",type:1,step:7};a&&(s.token="",s.type=2,s.mixAcc=o),e.buryLog(s,function(){e.isFirst=!1,e.getInfo("login")})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},backRole:function(e){var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_acc"),n=storage.getItem("sy_mixAcc"),s={};null!=a?s.account_id=a.account_id:null!=n&&(s.account_id=n),s.back_acc=e.back_acc,s.back_no=e.code,s.ctime=e.ctime,s.flag=e.flag,s.ts=Math.round(new Date/1e3),s.sign=sign(s,i.config.activity_secret),t.ajax({
url:i.config.activityapi_url+"/anniversary/backRole",data:s,type:"get",success:function(t){var e=JSON.parse(t);if(666==e.error){var a={token:o,copyAcc:i.copyAcc,mixAcc:n,type:1,is_back:"",step:5};null!=n&&(a.type=2),i.buryLog(a)}},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},getBackRole:function(){var e=this,i=storage.getItem("sy_acc"),o=storage.getItem("sy_mixAcc"),a={};a.copyAcc=e.copyAcc,null!=i?a.account_id=i.account_id:null!=o&&(a.account_id=o),a.ts=Math.round(new Date/1e3),a.sign=sign(a,e.config.activity_secret),t.ajax({url:e.config.activityapi_url+"/anniversary/backNo",data:a,type:"post",success:function(t){0==t.code&&e.backRole(t.data)},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},addressPop:function(t){this.$dialog_lottery.hide(),s||2!=o?this.myPop():this.$dialog_address.show()},addPop:function(e){this.$dialog_my.hide();var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_mixAcc"),n=storage.getItem("sy_is_ally"),s={};s.token=o,s.type=1,n&&(s.token=0,s.type=2,s.mixAcc=a),s.ts=Math.round(new Date/1e3),s.sign=sign(s,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/main",data:s,type:"post",success:function(e){0==e.code?(0==e.data.is_commit_address?(i.$dialog_address.find('input[name="name"]').val(""),i.$dialog_address.find('input[name="phone"]').val(""),i.$dialog_address.find(".area").html("<span>请选择地区</span>"),i.$dialog_address.find('input[name="address"]').val(""),i.$dialog_address.find(".area").show(),i.$dialog_address.find(".btn-save").show()):(i.$dialog_address.find('input[name="name"]').val(e.data.name),i.$dialog_address.find('input[name="phone"]').val(e.data.contact),i.$dialog_address.find('input[name="address"]').val(e.data.address),i.$dialog_address.find(".area").hide(),i.$dialog_address.find(".btn-save").hide()),i.$dialog_address.show()):1003==e.code?i.refreshToken(o,t.proxy(i.addPop,i)):(i.$dialog_address.find('input[name="name"]').val(""),i.$dialog_address.find('input[name="phone"]').val(""),i.$dialog_address.find(".area").html("<span>请选择地区</span>"),i.$dialog_address.find('input[name="address"]').val(""),i.$dialog_address.find(".area").show(),i.$dialog_address.find(".btn-save").show(),i.$dialog_address.show())},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})},selectArea:function(){new MobileSelect({trigger:"#triggerCity",title:"地区选择",wheels:[{data:cityData}],callback:function(t,e){console.log(e)}})},saveAddress:function(e){var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_mixAcc"),n=storage.getItem("sy_is_ally"),s={};return s.token=o,s.type=1,n&&(s.token=0,s.type=2,s.mixAcc=a),s.name=i.$dialog_address.find('input[name="name"]').val(),s.contact=i.$dialog_address.find('input[name="phone"]').val(),s.city=i.$dialog_address.find(".area").html(),s.address=i.$dialog_address.find('input[name="address"]').val(),""==s.name?(i.$dialog_address.toast({textAlign:"center",content:"请输入真实姓名~",duration:2e3}),!1):""!=s.contact&&i.isPhone(s.contact)?"<span>请选择地区</span>"==s.city?(i.$dialog_address.toast({textAlign:"center",content:"请选择地区~",duration:2e3}),!1):""==s.address?(i.$dialog_address.toast({textAlign:"center",content:"请输入详细地址~",duration:2e3}),!1):(s.ts=Math.round(new Date/1e3),s.sign=sign(s,i.config.activity_secret),void t.ajax({url:i.config.activityapi_url+"/anniversary/editInfo",data:s,type:"post",success:function(e){0==e.code?(i.$dialog_address.toast({textAlign:"center",content:"收获地址修改成功~",duration:2e3}),i.isFirst=!1,i.getInfo(),i.$dialog_address.hide()):1003==e.code?i.refreshToken(o,t.proxy(i.saveAddress,i)):i.$dialog_address.toast({textAlign:"center",content:e.message,duration:2e3})},complete:function(t,e){200!=t.status&&i.$dialog_address.toast({textAlign:"center",content:"系统繁忙，请稍候再试~",duration:2e3})}})):(i.$dialog_address.toast({textAlign:"center",content:"请输入11位手机号码~",duration:2e3}),!1)},receive:function(e){e=e||window.event;var i=e.currentTarget,o=this,a={},n=t(i).hasClass("is_receive"),s=storage.getItem("sy_role_info");if(n)return!1;if(!s)return o.$dialog_my.hide(),o.bindPop(),t("body").toast({position:"fixed",textAlign:"center",content:"请先完成角色绑定~",duration:2e3}),!1;var r=s.role_id,c=s.platform,d=s.zone_id,l=t(i).attr("data-account_id"),g=t(i).attr("data-id"),p=t(i).attr("data-ctime"),_=t(i).attr("data-flag");a.role_id=r,a.platform=c,a.zone_id=d,a.account_id=l,a.id=g,a.ctime=p,a.flag=_,a.ts=Math.round(new Date/1e3),a.sign=sign(a,o.config.activity_secret),t.ajax({url:"https://weekly-sszg.shiyuegame.com/api.php/pf/towns/gift",data:a,type:"get",success:function(e){var a=JSON.parse(e);if(666==a.error){t("body").toast({position:"fixed",textAlign:"center",content:"领取成功，预计24小时内发到绑定角色上~",duration:2e3});var n="已发给"+s.server_name+"-"+s.role_name;t(i).html(n),t(i).addClass("is_receive"),o.editGift(g)}else t("body").toast({position:"fixed",textAlign:"center",content:a.msg,duration:2e3})},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},editGift:function(e){var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_mixAcc"),n=storage.getItem("sy_is_ally"),s=storage.getItem("sy_role_info"),r={};r.token=o,r.type=1,n&&(r.token=0,r.type=2,r.mixAcc=a),r.id=e,r.role_name=s.role_name,r.server_name=s.server_name,r.role_id=s.role_id,r.platform=s.platform,r.zone_id=s.zone_id,r.ts=Math.round(new Date/1e3),r.sign=sign(r,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/editGift",data:r,type:"post",success:function(t){},complete:function(e,i){200!=e.status&&t("body").toast({position:"fixed",content:"系统繁忙，请稍候再试~",duration:2e3})}})},timeDuring:function(t){var e=new Date(1e3*t),i=e.getFullYear()+"-",o=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",a=e.getDate()<10?"0"+e.getDate():e.getDate();return i+o+a},renderMy:function(t){var e=this,i="",o="<li>";o+='<div class="e1">奖品名称</div>',o+='<div class="e2">获取时间</div>',o+='<div class="e3">奖品内容</div>',o+="</li>";for(var a=0,n=t.length;a<n;a++)i=t[a].time.split(" ")[0],o+="<li>",4==t[a].gift_id||5==t[a].gift_id||6==t[a].gift_id||7==t[a].gift_id||8==t[a].gift_id?o+='<div class="e1">'+t[a].masonry+"钻石</div>":o+='<div class="e1">'+t[a].gift_name+"</div>",o+='<div class="e2">'+i+"</div>",2==parseInt(t[a].type)?o+='<div class="e3">实物</div>':null!=t[a].role_info&&"1"==t[a].send_status?o+='<div class="e3">已发给'+t[a].role_info.server_name+"-"+t[a].role_info.role_name+"</div>":(o+='<div class="e3 receive" data-account_id = "'+t[a].account_id+'"',o+='data-id="'+t[a].id+'"',o+='data-ctime="'+t[a].ctime+'"',o+='data-flag="'+t[a].flag+'">',o+='<a href="javascript:;">领取</a></div>',o+="</li>");e.$dialog_my.find(".my-box").html(o),e.$dialog_my.show()},myPop:function(e){this.$dialog_lottery.hide();var i=this,o=storage.getItem("sy_token"),a=storage.getItem("sy_mixAcc"),n=storage.getItem("sy_is_ally"),s={};s.token=o,s.type=1,n&&(s.token=0,s.type=2,s.mixAcc=a),s.ts=Math.round(new Date/1e3),s.sign=sign(s,i.config.activity_secret),t.ajax({url:i.config.activityapi_url+"/anniversary/giftList",data:s,type:"post",success:function(e){0==e.code&&0!=e.data.length?i.renderMy(e.data):1003==e.code?i.refreshToken(o,t.proxy(i.myPop,i)):(i.$dialog_my.find(".my-box").html("暂无记录~"),i.$dialog_my.show())},complete:function(t,e){200!=t.status&&i.$dialog_my.toast({content:"系统繁忙，请稍候再试~",duration:2e3})}})},closePop:function(t){t.hide()},buryLog:function(e,i){var o=this,a={};a.token=e.token||"",a.copyAcc=e.copyAcc||"",a.mixAcc=e.mixAcc||"",a.type=e.type||"1",a.is_back=e.is_back||"",a.step=e.step,a.ts=Math.round(new Date/1e3),a.sign=sign(a,o.config.activity_secret),t.ajax({url:o.config.activityapi_url+"/anniversary/log",data:a,type:"post",success:function(t){0==t.code&&i&&i(t.data)},complete:function(t,e){200!=t.status&&console.log("埋点请求出错")}})},slideInit:function(){t(".card-slide").slide({titCell:".hd ul",mainCell:".bd ul",autoPage:!1,effect:"left",autoPlay:!1,autoPage:!0,pnLoop:!1,scroll:1,vis:5,trigger:"click"})},swiperInit:function(){new Swiper(".gift-swiper",{autoplay:!0,loop:!0,centeredSlides:!0,slidesPerView:3,navigation:{nextEl:".gift-next",prevEl:".gift-prev"},pagination:{el:".swiper-pagination-gift",clickable:!0}}),new Swiper(".feature-swiper",{pagination:{el:".swiper-pagination-feature",clickable:!0},parallax:!0,loop:!0,speed:300,centeredSlides:!0,slidesPerView:"auto",autoplay:{disableOnInteraction:!1,delay:3e3},navigation:{nextEl:".feature-next",prevEl:".feature-prev"},effect:"coverflow",coverflowEffect:{rotate:0,stretch:224,depth:200,modifier:1,slideShadows:!1}})},copy:function(){var e=new ClipboardJS(".copy");e.on("success",function(e){t("body").toast({position:"fixed",textAlign:"center",content:"复制成功~",duration:2e3})}),e.on("error",function(e){t("body").toast({position:"fixed",textAlign:"center",content:"复制失败~",duration:2e3}),console.log(e)})},task:function(e){var i=t(".page3 .title").offset().top-16;t("html,body").animate({scrollTop:i},700)},rule:function(e){var i=t(".page6 .title").offset().top-t(".header").height();t("html,body").animate({scrollTop:i},700)},videoPlay:function(e){e=e||window.event;var i=e.currentTarget,o=this,a=null,n=t(i).attr("data-poster"),s=t(i).attr("data-video");clearTimeout(a),o.$pop_video.find("video").attr({poster:n,src:s}),a=setTimeout(function(){o.$pop_video.find("video")[0].currentTime=0,o.$pop_video.find("video")[0].play()},100),o.$pop_video.show()},videoClose:function(t){this.$pop_video.hide(),this.$pop_video.find("video")[0].pause()}}),t(document).ready(function(){(new d).init()})})(jQuery);